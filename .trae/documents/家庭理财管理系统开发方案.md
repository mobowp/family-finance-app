# 家庭理财管理系统开发方案

根据您的需求，我为您设计了基于 **Next.js 全栈框架** 的开发方案。这个架构既能满足Web端的高效开发，也能通过响应式设计适配移动端，同时保持系统的可扩展性和维护性。

## 1. 系统架构与技术选型

### 技术栈 (Tech Stack)
- **开发语言**: TypeScript (全栈类型安全)
- **前端框架**: Next.js 14+ (App Router) - 提供服务端渲染和API路由
- **UI 组件库**: Shadcn/ui + Tailwind CSS - 现代、美观、轻量
- **图表库**: Recharts 或 ECharts - 用于数据可视化
- **后端框架**: Next.js Server Actions / API Routes
- **数据库**: PostgreSQL - 稳定可靠的关系型数据库
- **ORM框架**: Prisma - 优秀的TypeScript支持，易于管理数据库结构
- **身份认证**: NextAuth.js (Auth.js) - 支持多用户和多种登录方式
- **外部接口**: `yahoo-finance2` (Node.js) - 用于获取股票/基金实时数据

### 架构设计
采用 **Modular Monolith (模块化单体)** 架构，主要分为以下层级：
1.  **表现层 (Frontend)**: 响应式页面，处理用户交互。
2.  **服务层 (Backend)**: 处理业务逻辑（如记账校验、资产估值计算）。
3.  **数据层 (Database)**: 持久化存储，通过Prisma进行访问。

## 2. 数据库设计方案 (核心表结构)

-   **User (用户表)**: `id`, `name`, `email`, `role` (管理员/普通成员)
-   **Account (账户表)**: `id`, `name`, `type` (现金/银行卡/信用卡/理财), `balance`, `currency`
-   **Category (分类表)**: `id`, `name`, `type` (收入/支出), `parent_id` (支持多级), `icon`
-   **Transaction (交易表)**: `id`, `amount`, `type`, `date`, `category_id`, `account_id`, `description`, `tags`
-   **Asset (资产表)**: `id`, `type` (股票/房产/黄金), `symbol` (代码), `quantity`, `cost_price`, `market_price`
-   **Budget (预算表)**: `id`, `category_id`, `amount`, `period` (月/年)

## 3. 核心功能实现思路

1.  **智能记账**:
    -   使用 React Hook Form 处理表单。
    -   实现“模板”功能，将常用交易存为预设配置，一键填入。
2.  **数据统计**:
    -   利用 Prisma 的 `groupBy` 和 `aggregate` 功能在数据库层面进行初步聚合。
    -   前端使用 Recharts 渲染图表，支持按日期范围筛选。
3.  **资产管理**:
    -   **股票/基金**: 创建定时任务 (Cron Job) 或在用户访问时触发，调用 Yahoo Finance API 更新 `market_price`。
    -   **自动计算**: 实时计算 `(当前价 - 成本价) * 数量` 得出浮动盈亏。
4.  **多账户与安全**:
    -   基于 NextAuth 实现会话管理。
    -   敏感数据（如密码）使用 bcrypt 加密存储。
    -   数据每日自动备份（可通过脚本导出 SQL）。

## 4. 开发优先级规划 (Roadmap)

### 第一阶段：基础设施与核心记账 (MVP)
-   [ ] 项目初始化 (Next.js + Prisma + Tailwind)
-   [ ] 数据库建模与迁移 (User, Account, Category, Transaction)
-   [ ] 基础UI框架搭建
-   [ ] 账户管理 (CRUD)
-   [ ] 记账功能 (记录收入/支出)

### 第二阶段：统计分析与预算
-   [ ] 统计仪表盘 (收支概览、饼图、趋势图)
-   [ ] 交易列表筛选与导出
-   [ ] 预算设置与超支提醒逻辑

### 第三阶段：资产管理
-   [ ] 资产录入 (房产、股票等)
-   [ ] 集成行情API，实现资产净值自动更新
-   [ ] 家庭资产负债表生成

### 第四阶段：优化与扩展
-   [ ] 多用户权限管理
-   [ ] 移动端适配优化 (PWA)
-   [ ] 数据导入导出 (Excel)

---

**建议下一步**:
我将开始 **第一阶段：基础设施与核心记账** 的开发。
1. 初始化 Next.js 项目。
2. 配置 PostgreSQL 数据库（如果您没有现成的数据库，我可以使用 SQLite 进行本地开发，之后可无缝切换）。
3. 搭建基础页面结构。
